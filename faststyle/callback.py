# AUTOGENERATED! DO NOT EDIT! File to edit: nbs/06_callback.ipynb (unless otherwise specified).

__all__ = ['SourceFeatsCallback']

# Cell
from fastai2.basics import *
from fastai2.callback.all import *
from faststyle import *

# Cell
class SourceFeatsCallback(Callback):
  def __init__(self, stl_fts, cnt_fts): self.stl_fts, self.cnt_fts = stl_fts,cnt_fts

  def after_pred(self):
    self.learn.yb = (*self.yb, self.stl_fts, self.cnt_fts)

  @classmethod
  def from_fns(cls, fns, get_feats):
    source_tims = L(TensorImage.create(fn) for fn in L(fns))
    stl_fts,cnt_fts = zip(*L(get_feats(o[None]) for o in source_tims))
    stl_fts,cnt_fts = L(zip(*stl_fts)),L(zip(*cnt_fts))
    return cls(stl_fts=stl_fts, cnt_fts=cnt_fts)